# CAD definition in KARE cohort

在昆山数据库中结合不同来源和类型的诊断信息对急性心梗进行精准定义。

## 精准定义总体思路

我们采用“多源证据分层 + 综合评分”的精准定义思路：
- 先在各临床域（手术、影像、化验、用药、心电图、症状、慢病史）中提取与急性心梗相关的原始记录，并保留发生时间；
- 将证据映射到金标准、强、中、弱四个等级，同时解释为何特定治疗或表现能代表更高的确诊可能；
- 以统一的公共表表达式整合不同证据，在患者层面统计首次出现时间、证据数量与得分，最终形成可分层的 CAD 判定结果。

这种方式兼顾了影像/化验等客观指标与临床处置、症状背景，可为科研和业务分析提供透明可追溯的判定过程。

## Oracle 实现思路

### 急性心梗的诊断标准
- 心肌损伤标志物（如肌钙蛋白、CK-MB）超过参考上限，提示存在心肌坏死。
- 出现典型急性缺血症状，例如静息性胸痛、伴放射痛的胸闷、心绞痛等。
- 心电图提示 ST 段抬高/压低、病理性 Q 波等急性缺血所致改变。
- 影像学检查显示冠脉狭窄或心肌灌注受损，包括冠脉造影、冠脉 CTA 等。
- 经血运重建手术（PCI/CABG）或抗血小板强化治疗后的诊治记录，为急性事件后的直接证据。

### 证据等级与数据来源
**金标准（Gold Standard）**
- 冠脉造影报告中狭窄程度 >50%，直接确认冠脉病变严重程度。
- 心肌损伤标志物显著高于正常值，客观反映急性心肌坏死。
- PCI、CABG 等冠脉重建手术史，表明既往发生的急性事件已通过介入/手术处理。
- 同次就诊开具双联抗血小板治疗：由于强化抗板治疗显著增加出血风险，临床上通常只在明确诊断或高度确诊的急性心梗患者中采用，因此可视为金标准级别的证据。

**强证据（Strong Evidence）**
- 冠脉 CTA 检出中度及以上狭窄，虽为无创手段但能可靠提示严重冠脉粥样硬化。
- 长期抗血小板（单药）治疗记录：长期维持抗板药物同样意味着医生权衡出血风险后仍需持续预防，再次指向既往急性事件或高危病变。
- 心电图出现 ST 段动态改变或病理性 Q 波，为急性缺血/梗死的特异性表现。
- 就诊记录中出现持续 ≥20 分钟的压榨性胸痛、向左上肢/下颌放射的胸闷痛、伴冷汗或恶心呕吐、劳累或静息即诱发的胸痛等特异性症状，提示急性冠脉综合征正在发作。

**中等证据（Moderate Evidence）**
- 非特异性胸闷、呼吸困难、上腹不适、乏力等症状，提示心肌缺血可能但缺乏特异性，需要与其他疾病鉴别。
- 其他 CAD 相关药物使用（如未达到双联/长期标准的抗板或抗凝治疗），表明医生对冠心病存在怀疑或预防性用药。

**弱证据（Weak Evidence）**
- 慢病史如高血压、糖尿病、血脂异常等心血管危险因素，为 CAD 的背景风险但非直接诊断依据。

### SQL 脚本

主脚本位于 [`sql/cad_definition_oracle.sql`](sql/cad_definition_oracle.sql)，使用公共表表达式整合所有证据源并输出最终的 CAD 分类结果。

为便于协作维护，具体的证据抽取逻辑已拆分到 [`sql/modules/`](sql/modules) 目录：

| 模块脚本 | 说明 |
| --- | --- |
| `procedure_evidence.sql` | 创建 `cad_procedure_evidence` 视图，抽取 PCI/CABG 等介入或手术记录 |
| `angiography_evidence.sql` | 创建 `cad_angiography_evidence` 视图，筛选狭窄 >50% 的冠脉造影结果 |
| `cta_evidence.sql` | 创建 `cad_cta_evidence` 视图，保留中度及以上狭窄的冠脉 CTA 报告 |
| `lab_biomarker_evidence.sql` | 创建 `cad_lab_biomarker_evidence` 视图以及相关阳性肌钙蛋白判定逻辑 |
| `dual_antiplatelet_therapy.sql` | 创建 `cad_dual_antiplatelet_therapy` 视图，识别同次就诊的双联抗板治疗 |
| `long_term_antiplatelet.sql` | 创建 `cad_long_term_antiplatelet` 视图，识别连续 ≥6 个月的长期抗板用药 |
| `maintenance_medications.sql` | 创建 `cad_maintenance_medications` 视图，收集其他 CAD 相关维持药物 |
| `ecg_evidence.sql` | 创建 `cad_ecg_evidence` 视图，抽取 ST 段改变、病理性 Q 波等心电图证据 |
| `specific_symptom_evidence.sql` | 创建 `cad_specific_symptom_evidence` 视图，保留典型缺血症状 |
| `general_symptom_evidence.sql` | 创建 `cad_general_symptom_evidence` 视图，保留非特异性症状 |
| `chronic_condition_history.sql` | 创建 `cad_chronic_condition_history` 视图，纳入高血压/糖尿病/血脂异常等慢病史 |

> 建议先在 Oracle 中依次执行模块脚本创建 `cad_` 前缀视图，再运行主脚本完成证据汇总。所有表名及代码仅作为模板示例，可根据实际库表结构和编码体系进行调整。

## 现阶段进度

- 肌钙蛋白检测：已完成（共 50,000 人检测，9,000 例阳性）
- 冠脉 CTA：已完成（共 2,000 人检测，623 例阳性）
- 冠脉造影：进行中（完成 50%，共 2,697 例检测）
- 药物识别：未开始
- 死亡原因识别：未开始
- 手术史整理：未开始（预期工作量大）
- 心电图识别：未开始（预期工作量大）
- 症状识别：未开始（预期工作量大）
